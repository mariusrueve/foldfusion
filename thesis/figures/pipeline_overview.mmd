flowchart TD
    A["Config.toml"] --> B["`Load & validate (Config)`"]
    B --> C["`Setup logging & output dirs`"]
    C --> D["`Init Evaluator`"]
    C --> E["`Init / reuse SIENA DB\n(SienaDB)`"]
    E --> F{"`For each UniProt ID\n(sequential or parallel)`"}

    subgraph G["Per-protein pipeline"]
      direction TB
      F --> G1["`Fetch AlphaFold PDB\n(AlphaFoldFetcher)\n+ trim low-confidence segments`"]
      G1 --> G2["`Predict pocket & EDF\n(DoGSite3)`"]
      G2 --> G3["`Search similar sites\n(SIENA)`"]
      G3 --> G4["`Extract ligands\n(LigandExtractor)`"]
      G4 --> G5["`Evaluate pre-JAMDA\n(Local RMSD, TCS)`"]
      G5 --> G6["`Optimize poses\n(JAMDA scorer)`"]
      G6 --> G7["`Evaluate post-JAMDA\n(Local RMSD, TCS)`"]
      G7 --> G8["`Write per-protein results`"]
    end

    G8 --> H{"More IDs?"}
    H -- yes --> F
    H -- no --> I["`Summarize & finish\n+ pipeline wall-clock time`"]

    I --> J[["Artifacts"]]
    J --> K["`Per-protein folders:\nAlphaFold / Dogsite3 / Siena / LigandExtractor / JamdaScorer`"]
    J --> L["`Evaluation/evaluation.json`"]
    J --> M["`Logs (rotating)`"]

    classDef accent fill:#e8f5e9,stroke:#2e7d32,color:#1b5e20,stroke-width:1px;
    class E,G3,G6 accent
